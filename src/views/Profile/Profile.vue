<template>
  <div class="fill-height">
    <v-container v-if="!loading" fluid>
      <v-row>
        <v-col cols="7">
          <v-row justify="space-between">
            <v-col cols="12">
              <ProfileSummary @section-selected="openSectionDialog"/>
            </v-col>

            <v-col cols="12">
              <about-section @edit="dialogs.about = true"/>
            </v-col>

            <v-col cols="12">
              <background-section @edited="(alert) => reqStatus = alert" @add="() => openSectionDialog('background')"/>
            </v-col>

            <v-col cols="12">
              <accomplishment-section @edited="(alert) => reqStatus = alert" @add="() => openSectionDialog('accomplishments')"/>
            </v-col>
          </v-row>
        </v-col>
      </v-row>

      <custom-dialog :show.sync="dialogs.intro">
        <template v-slot:body>
          <intro-form  @show-alert="(alert) => reqStatus = alert" @close="dialogs.intro = false"/>
        </template>
      </custom-dialog>
      <custom-dialog :show.sync="dialogs.background">
        <template v-slot:body>
          <background-form @show-alert="(alert) => reqStatus = alert" @close="dialogs.background = false"/>
        </template>
      </custom-dialog>
      <custom-dialog :show.sync="dialogs.accomplishments">
        <template v-slot:body>
          <accomplishment-form @show-alert="(alert) => reqStatus = alert" @close="dialogs.accomplishments = false"/>
        </template>
      </custom-dialog>
      <custom-dialog :show.sync="dialogs.skills">
        <template v-slot:body>
          <skill-form @close="dialogs.skills = false"/>
        </template>
      </custom-dialog>
      <custom-dialog :show.sync="dialogs.about">
        <template v-slot:body>
          <about-form @close="dialogs.about = false"/>
        </template>
      </custom-dialog>

      <custom-alert v-model="reqStatus.status" @input="reqStatus.status = !reqStatus.status"
                    :message="reqStatus.message" :type="reqStatus.type"/>

    </v-container>
    <spinner v-else/>
  </div>
</template>

<script>
  import ProfileSummary from "../../components/Profile/ProfileSummary";
  import CustomDialog from "../../components/Dialogs/CustomDialog";
  import BackgroundForm from "../../components/Forms/BackgroundForm";
  import IntroForm from "../../components/Forms/IntroForm";
  import AccomplishmentForm from "../../components/Forms/AccomplishmentForm";
  import SkillForm from "../../components/Forms/SkillForm";
  import AboutSection from "../../components/Profile/AboutSection";
  import AboutForm from "../../components/Forms/AboutForm";
  import BackgroundSection from "../../components/Profile/BackgroundSection";
  import AccomplishmentSection from "../../components/Profile/AccomplishmentSection";
  import {mapActions, mapGetters} from "vuex";
  import Spinner from "../../components/Loaders/Spinner";
  import CustomAlert from "../../components/Alerts/CustomAlert";

  export default {
    name: "Profile",
    components: {
      CustomAlert,
      Spinner,
      AccomplishmentSection,
      BackgroundSection,
      AboutForm,
      AboutSection, SkillForm, AccomplishmentForm, IntroForm, BackgroundForm, CustomDialog, ProfileSummary
    },

    computed: {
      ...mapGetters("profileModule", ["profile"]),
      ...mapGetters("typeModule", ["industries"]),
    },

    data() {
      return {
        dialogs: {
          background: false,
          intro: false,
          accomplishments: false,
          skills: false,
          about: false
        },
        reqStatus: {
          message: "",
          type: "",
          status: false
        },
        loading: false,
      }
    },

    methods: {
      ...mapActions({
        getProfile: "profileModule/getProfile",
        setChildren: "sectionModule/setChildren",
        setTypeItems: "typeModule/setTypeItems",
        getBackgrounds: "sectionModule/getBackgrounds",
        getAcc: "sectionModule/getAcc"
      }),
      openSectionDialog(section) {
        console.log(section)
        this.dialogs[section.toLowerCase()] = true
      },

      async setSectionChildren(section) {
        await this.setChildren(section)
      },

      async initSubSections() {
        await this.setSectionChildren("background");
        await this.setSectionChildren("accomplishments");
      },

      async initTypes() {
        await this.setTypeItems("industries");
        await this.setTypeItems("formerNameVisTypes");
      },

      async getProfileBackgrounds() {
        await this.getBackgrounds();
      },

      async getProfileAcc() {
        await this.getAcc();
      },
    },

    async created() {
      this.loading = true;
      await this.getProfile();
      await this.initSubSections();
      await this.getProfileBackgrounds();
      await this.getProfileAcc();
      await this.initTypes();
      this.loading = false;
    }
  }
</script>

<style scoped>

</style>
